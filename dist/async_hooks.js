var d=1,y=new Map,a=0,n=[];function h(){return d++}var o=class{constructor(t,r=a){this._type=t,this._asyncId=h(),this._triggerAsyncId=r,n.forEach(e=>{e.enabled&&e.callbacks.init&&e.callbacks.init(this._asyncId,this._type,this._triggerAsyncId,this)})}runInAsyncScope(t,r,...e){let i=a;a=this._asyncId,n.forEach(c=>{c.enabled&&c.callbacks.before&&c.callbacks.before(this._asyncId)});try{return t.apply(r,e)}finally{n.forEach(c=>{c.enabled&&c.callbacks.after&&c.callbacks.after(this._asyncId)}),a=i}}emitDestroy(){n.forEach(t=>{t.enabled&&t.callbacks.destroy&&t.callbacks.destroy(this._asyncId)})}asyncId(){return this._asyncId}triggerAsyncId(){return this._triggerAsyncId}},u=class{constructor(){this._storeMap=new Map}run(t,r,...e){let i=new o("AsyncLocalStorage");return i.runInAsyncScope(()=>{this._storeMap.set(i.asyncId(),t);try{return r(...e)}finally{this._storeMap.delete(i.asyncId())}})}getStore(){return this._storeMap.get(a)}},l=class{constructor(t){this.callbacks=t||{},this.enabled=!1}enable(){return this.enabled||(this.enabled=!0,n.includes(this)||n.push(this)),this}disable(){this.enabled=!1;let t=n.indexOf(this);return t!==-1&&n.splice(t,1),this}};function b(s){return new l(s)}function p(){return a}function g(){let s=y.get(a);return s?s.triggerAsyncId:0}var f=globalThis.setTimeout;globalThis.setTimeout=(s,t,...r)=>{let e=new o("Timeout");return f(()=>{e.runInAsyncScope(()=>{s(...r),e.emitDestroy()})},t)};export{u as AsyncLocalStorage,o as AsyncResource,b as createHook,p as executionAsyncId,g as triggerAsyncId};
/*! For license information please see async_hooks.js.LEGAL.txt */
